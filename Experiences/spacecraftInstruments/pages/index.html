<!DOCTYPE html>
<html>
<head>
	<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
	<script>
		const boxDefaults = {scale:{x:1, y:1, z:1}, rotation:"0 45 0", enlarged:false, animating:false};
		const componentPositions = {
			multi:{x:-2, y:3, z:-7.5},
			gamma:{x:2, y:3, z:-7.5},
			magnet:{x:2, y:-1, z:-7.5},
			xband:{x:-2, y:-1, z:-7.5},
			multi2:{x:-2, y:3, z:-7.5},
			gamma2:{x:2, y:3, z:-7.5},
			magnet2:{x:2, y:-1, z:-7.5}
		};
		let boxes = [
			boxDefaults, boxDefaults
		];
		var state = 1;
		AFRAME.registerComponent('separate-event', {
			init: function () {
				var el = this.el; // spacecraft
				el.addEventListener('click', function () {
					if (state == 1) {
						// stop spacecraft rotation
						el.setAttribute('animation', "property: rotation; to: 0 0 0; loop: false; dur: 0");
						// lower spacecraft opacity
						el.setAttribute('material', "opacity: 0.3; transparent: true");
						// shrink spacecraft
						el.setAttribute('scale', "1.5 1.5 1.5");

						// make instruments visible
						var component = document.querySelector('a-box#multi');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: -2 3 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 1 1 1; loop: false; dur: 300; easing: linear');
						var componentText = document.querySelector('a-text#multiText');
						componentText.setAttribute('scale', '1 1 1');
						componentText.setAttribute('position',{x:-3, y:3, z:-4.5});
						// ...and for models
						var component = document.querySelector('a-entity#multi2');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: -2 3 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 0.5 0.5 0.5; loop: false; dur: 300; easing: linear');
						
						var component = document.querySelector('a-box#gamma');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: 2 3 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 1 1 1; loop: false; dur: 300; easing: linear');
						var componentText = document.querySelector('a-text#gammaText');
						componentText.setAttribute('scale', '1 1 1');
						componentText.setAttribute('position',{x:1.5, y:3, z:-4.5});
						// ...and for models
						var component = document.querySelector('a-entity#gamma2');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: 2 3 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 0.5 0.5 0.5; loop: false; dur: 300; easing: linear');

						var component = document.querySelector('a-box#magnet');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: 2 -1 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 1 1 1; loop: false; dur: 300; easing: linear');
						var componentText = document.querySelector('a-text#magnetText');
						componentText.setAttribute('scale', '1 1 1');
						componentText.setAttribute('position',{x:1.5, y:-1, z:-4.5});
						// ...and for models
						var component = document.querySelector('a-entity#magnet2');
						component.setAttribute('material', 'wireframe: true');
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: 2 -1 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 0.5 0.5 0.5; loop: false; dur: 300; easing: linear');

						var component = document.querySelector('a-box#xband');
						component.setAttribute('material', "wireframe: true");
						component.removeAttribute('animation');
						component.removeAttribute('animation__2');
						component.setAttribute('animation', 'property: position; to: -2 -1 -7.5; loop: false; dur: 300; easing: linear');
						component.setAttribute('animation__2', 'property: scale; to: 1 1 1; loop: false; dur: 300; easing: linear');
						var componentText = document.querySelector('a-text#xbandText');
						componentText.setAttribute('scale', '1 1 1');
						componentText.setAttribute('position',{x:-3, y:-1, z:-4.5});

						// change state
						state = 2;
					} else if (state == 2) {
						// resume spacecraft rotation
						el.setAttribute('animation', "property: rotation; to: 0 90 0; easing: linear; loop: true; dur: 1000");
						// restore spacecraft opacity
						el.setAttribute('material', "opacity: 1; transparent: false");
						// shrink spacecraft
						el.setAttribute('scale', "2 2 2");

						// hide components and associated text
						const components = document.querySelectorAll("a-box.component");
						components.forEach((item) => {
							item.removeAttribute('animation');
							item.removeAttribute('animation__2');
							item.setAttribute('animation', 'property: position; to: 0 1 -7.5; loop: false; dur: 300; easing: linear');
							item.setAttribute('animation__2', 'property: scale; to: 0 0 0; loop: false; dur: 300; easing: linear');
						});
						const texts = document.querySelectorAll("a-text.componentText");
						texts.forEach((item) => {
							item.setAttribute('scale', '0 0 0')
						});
						// ...and for models
						const componentModels = document.querySelectorAll("a-entity.component");
						componentModels.forEach((item) => {
							item.removeAttribute('animation');
							item.removeAttribute('animation__2');
							item.setAttribute('animation', 'property: position; to: 0 1 -7.5; loop: false; dur: 300; easing: linear');
							item.setAttribute('animation__2', 'property: scale; to: 0 0 0; loop: false; dur: 300; easing: linear');
						});

						// change state
						state = 1;
					}
				});
			}

		});

		AFRAME.registerComponent('component-select', {
			init: function () {
				const el = this.el;
				const selectRing = document.querySelector("#selectRing"); 
				el.addEventListener('mouseenter', function() {
					if (state == 2) {
						// make selected
						el.setAttribute('material', 'wireframe: false');
						selectRing.setAttribute('position', componentPositions[el.getAttribute('id')]);
						selectRing.setAttribute('radius-inner', '.85');
						selectRing.setAttribute('radius-outer', '.95');
					}
				});
				el.addEventListener('mouseleave', function() {
					if (state == 2) {
						// make un-selected
						el.setAttribute('material', 'wireframe: true');
						selectRing.setAttribute('position', '0 1 -7.5');
						selectRing.setAttribute('radius-inner', '0');
						selectRing.setAttribute('radius-outer', '0');
					}
				});
				el.addEventListener('click', function() {
					if (state == 2) {
						// make un-selected
						selectRing.setAttribute('position', '0 1 -7.5');
						selectRing.setAttribute('radius-inner', '0');
						selectRing.setAttribute('radius-outer', '0');

						// move component to center
						el.removeAttribute('animation');
						el.removeAttribute('animation__2');
						el.setAttribute('animation', 'property: position; to: 0 1 -7.5; loop: false; dur: 300; easing: linear');
						//el.setAttribute('animation__2', 'property: scale; to: 2 2 2; loop: false; dur: 300; easing: linear');
						// ...and for models a different scale
						el.setAttribute('animation__2', 'property: scale; to: 1 1 1; loop: false; dur: 300; easing: linear');
						// hide spacecraft
						const craft = document.querySelector("a-box.spacecraft");
						craft.setAttribute('scale', '0 0 0');
						// hide other components
						const components = document.querySelectorAll("a-box.component");
						components.forEach((item) => {
							if (item != el) {
								item.setAttribute('scale', '0 0 0');
							}
						});
						// ...and for models
						const componentModels = document.querySelectorAll("a-entity.component");
						componentModels.forEach((item) => {
							if (item != el) {
								item.setAttribute('scale', '0 0 0');
							}
						});
						// hide component text
						const componentText = document.querySelectorAll("a-text.componentText");
						componentText.forEach((item) => {
							item.setAttribute('scale', '0 0 0');
						});

						// change state
						state = 3;
					} else if (state == 3) {
						// restore spacecraft visibility
						const craft = document.querySelector("a-box.spacecraft");
						craft.setAttribute('scale', '1 1 1');

						// make other components visible
						const components = document.querySelectorAll("a-box.component");
						components.forEach((item) => {
							item.setAttribute('material', "wireframe: true");
							item.setAttribute('scale', '1 1 1');
							const id = item.getAttribute('id');
							item.setAttribute('position', componentPositions[id]);
						});
						// ...and for models
						const componentModels = document.querySelectorAll("a-entity.component");
						componentModels.forEach((item) => {
							item.setAttribute('material', "wireframe: true");
							item.setAttribute('scale', '0.5 0.5 0.5');
							const id = item.getAttribute('id');
							item.setAttribute('position', componentPositions[id]);
						});

						// restore component texts
						const componentText = document.querySelectorAll("a-text.componentText");
						componentText.forEach((item) => {
							item.setAttribute('scale', '1 1 1');
						});

						// change state
						state = 2;
					}
				});
			}
		});

	</script>
</head>

<body>
	<a-scene>
		<!-- spacecraft -->
		<a-box class="spacecraft" position="0 1 -7.5" scale="2 2 2" rotation="0 0 0" color="gray"
		animation="property: rotation; to: 0 90 0; easing: linear; loop: true; dur: 1000"
		material="src: ../../../src/img/spacecraft.png; color: #696969; roughness: 1; metalness: 0"
		separate-event></a-box>
		<!-- components -->
		<!--<a-assets>
			<a-asset-item id="multipectral" src="../../../models/gltf/spacecraft/multispectral_imager.glb"></a-asset-item>
		</a-assets>
		-->
		<a-entity class="component" id="multi2" gltf-model="url(../../../models/gltf/spacecraft/multispectral_imager.gltf)"
				position="0 1 -7.5" rotation="-20 60 0" scale="0 0 0" component-select></a-entity>
		<a-entity class="component" id="gamma2" gltf-model="url(../../../models/gltf/spacecraft/gamma_ray_and_neutron_spectrometer.gltf)"
				position="0 1 '7.5" rotation="0 -30 0" scale="0 0 0" component-select></a-entity>
		<a-entity class="component" id="magnet2" gltf-model="url(../../../models/gltf/spacecraft/magnetometer.gltf)"
				position="0 1 '7.5" rotation="0 -40 0" scale="0 0 0" component-select></a-entity>
		<a-box class="component" id="multi" position="0 1 -7.5" scale="0 0 0" rotation="0 0 0" color="blue" component-select></a-box>
		<a-box class="component" id="gamma" position="0 1 -7.5" scale="0 0 0" rotation="0 0 0" color="red" component-select></a-box>
		<a-box class="component" id="magnet" position="0 1 -7.5" scale="0 0 0" rotation="0 0 0" color="green" component-select></a-box>
		<a-box class="component" id="xband" position="0 1 -7.5" scale="0 0 0" rotation="0 0 0" color="yellow" component-select></a-box>
		<!-- component text -->
		<a-text class="componentText" id="multiText" value="Multispectral Imager"></a-text>
		<a-text class="componentText" id="gammaText" value="Gamma Ray and\nNeutron Spectrometer"></a-text>
		<a-text class="componentText" id="magnetText" value="Magnetometer"></a-text>
		<a-text class="componentText" id="xbandText" value="X-band Radio\nTelecommunications"></a-text>
		<!-- selection ring -->
		<a-ring id="selectRing" position="0 1 -7.5" color="lightblue" radius-inner="0" radius-outer="0"></a-ring>

		<a-camera><a-cursor></a-cursor></a-camera>
	</a-scene>
</body>

</html>