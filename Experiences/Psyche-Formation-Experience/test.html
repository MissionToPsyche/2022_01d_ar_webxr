<head>
	<title>My A-Frame Scene</title>
	<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
	<!-- A-timeline scripts -->
	<script src="https://unpkg.com/aframe-animation-component@^4.1.1/dist/aframe-animation-timeline-component.min.js"></script> 
	<script src="https://unpkg.com/aframe-animation-timeline-component@1.6.0/dist/aframe-animation-timeline-component.min.js"></script>
	<!-- Particle scripts--> 
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@master/dist/aframe-particle-system-component.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.2.0/dist/aframe-extras.min.js"></script>
      
    
    <script>
        AFRAME.registerComponent('create-crater', {
            init: function () {
                var el = this.el;

                // Add a collision listener to the entity
                el.addEventListener('collide', function (event) {
                if (event.detail.body.el.id === 'sphere1' || event.detail.body.el.id === 'sphere2') {
                    // The entity has collided with one of the sphere entities
                    var position = event.detail.contact.getImpactPoint();
                    var normal = event.detail.contact.getImpactNormal();
                    var size = 0.3;

                    // Create a new geometry for the crater entity
                    var geometry = new THREE.CylinderGeometry(size, size, 0.01, 32, 1, true);
                    geometry.translate(0, -0.005, 0);
                    geometry.rotateX(-Math.PI / 2);
                    geometry.scale(1 + Math.random(), 1, 1 + Math.random());

                    // Create a new crater entity
                    var crater = document.createElement('a-entity');
                    crater.setAttribute('geometry', {primitive: 'buffered', buffer: geometry});
                    crater.setAttribute('material', {color: '#b79d94', roughness: 1, metalness: 0});
                    crater.setAttribute('position', position);
                    crater.setAttribute('rotation', {x: normal.x, y: normal.y, z: normal.z});
                    el.sceneEl.appendChild(crater);
                }
                });
            }
            });
    </script>

    <script>
        AFRAME.registerComponent('move-towards', {
            schema: {
                target: {type: 'selector'}
            },
            tick: function (time, timeDelta) {
                var position = this.el.getAttribute('position');
                var targetPosition = this.data.target.getAttribute('position');
                var distance = position.distanceTo(targetPosition);
                var speed = 0.01; // adjust this to control the speed of the movement
                if (distance > 0.1) {
                var direction = new THREE.Vector3().subVectors(targetPosition, position).normalize();
                var newPosition = new THREE.Vector3().addVectors(position, direction.multiplyScalar(speed * timeDelta));
                this.el.setAttribute('position', newPosition);
                }
            }
            });
    </script>
</head>

<body>
    <a-scene>
        <a-sphere id="planet" radius="5" position="0 0 -10" color="blue"
                  sphere-collider="objects: .craterable"
                  event-set__crater="_event: collide; _target: #planet; material.color: red">
        </a-sphere>
        
        <a-entity id="projectile" class="craterable" geometry="primitive: box; height: 0.2; width: 0.2; depth: 0.2"
                  position="0 8 -10" velocity="0 -2 0" color="red">
        </a-entity>

        <a-entity id="explosion" geometry="primitive: sphere; radius: 1" material="shader: flat; color: orange; opacity: 0;"
                position="0 0 -10" scale="0 0 0"></a-entity>

        <script>
            var planetEl = document.querySelector('#planet');
            var explosionEl = document.querySelector('#explosion');

            planetEl.addEventListener('collide', function (event) {
                var targetEl = event.detail.target;
                if (targetEl.classList.contains('craterable')) {
                explosionEl.setAttribute('position', event.detail.contact.point);
                explosionEl.setAttribute('scale', '1 1 1');
                targetEl.setAttribute('material', 'color', 'red');
                }
            });
        </script>


        <script>
            setInterval(function() {
              var projectile = document.querySelector('#projectile');
              var position = projectile.getAttribute('position');
              var velocity = projectile.getAttribute('velocity');
              position.x += velocity.x / 100;
              position.y += velocity.y / 100;
              position.z += velocity.z / 100;
              projectile.setAttribute('position', position);
            }, 10);
          </script>


      </a-scene>
</body>